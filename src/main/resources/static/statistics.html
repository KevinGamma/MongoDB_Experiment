<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB æ•°æ®ç»Ÿè®¡</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.38/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js"></script>
    <style>
        body {
            font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            background: radial-gradient(circle at 20% 20%, #e7f1ff, #f8fbff 35%, #ffffff 80%);
            color: #1f2937;
            margin: 0;
            padding: 0;
        }
        header {
            padding: 24px;
            background: linear-gradient(120deg, #7c3aed, #a855f7);
            color: #ffffff;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }
        h1 {
            margin: 0 0 4px;
            font-size: 28px;
            font-weight: 700;
        }
        p.subtitle {
            margin: 0;
            opacity: 0.9;
        }
        .container {
            max-width: 1200px;
            margin: 24px auto 48px;
            padding: 0 16px;
        }
        .nav-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            background: #7c3aed;
            color: #ffffff;
            padding: 14px 16px;
            border-radius: 14px;
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.2);
            margin-bottom: 16px;
        }
        .nav-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav-card button {
            border: none;
            background: #ffffff;
            color: #0f172a;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.12s ease, box-shadow 0.12s ease;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
        }
        .nav-card button:hover {
            transform: translateY(-2px);
        }
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        .card {
            background: #ffffff;
            border-radius: 12px;
            padding: 14px 16px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 22px rgba(0, 0, 0, 0.06);
        }
        .card h3 {
            margin: 0 0 8px;
            color: #7c3aed;
            font-size: 15px;
        }
        .card button {
            width: 100%;
            border: none;
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            color: #ffffff;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.15s ease;
        }
        .card button:hover {
            opacity: 0.9;
        }
        .card button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .status {
            margin-bottom: 12px;
            padding: 12px 14px;
            border-radius: 10px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
        }
        .status strong {
            color: #0f172a;
        }
        .table-wrapper {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        }
        th, td {
            padding: 10px 12px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
            font-size: 14px;
            white-space: nowrap;
        }
        th {
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            font-weight: 700;
            color: #ffffff;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:hover td {
            background: #f8fafc;
        }
        .error {
            color: #b91c1c;
            margin: 8px 0 0;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-excellent {
            background: #dcfce7;
            color: #166534;
        }
        .badge-good {
            background: #dbeafe;
            color: #1e40af;
        }
        .badge-pass {
            background: #fef9c3;
            color: #854d0e;
        }
        .badge-fail {
            background: #fee2e2;
            color: #991b1b;
        }
        @media (max-width: 640px) {
            h1 { font-size: 22px; }
            .card button { font-size: 13px; }
            th, td { font-size: 13px; padding: 8px 10px; }
        }
    </style>
</head>
<body>
<header>
    <h1>ğŸ“Š æ•°æ®ç»Ÿè®¡åˆ†æ</h1>
    <p class="subtitle">Spring Boot + Vue + MongoDB é€‰è¯¾æ•°æ®ç»Ÿè®¡</p>
</header>

<div id="app" class="container">
    <div class="nav-card">
        <div>
            <strong>å¯¼èˆª</strong>
            <span style="margin-left:8px;opacity:0.9;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰§è¡Œç»Ÿè®¡æŸ¥è¯¢</span>
        </div>
        <div class="nav-actions">
            <button onclick="location.href='index.html'">è¿”å›ä¸»é¡µ</button>
        </div>
    </div>

    <div class="cards">
        <div v-for="(query, index) in queries" :key="query.label" class="card">
            <h3>{{ index + 1 }}. {{ query.label }}</h3>
            <p style="min-height:36px;margin:6px 0;color:#4b5563;font-size:13px;">{{ query.desc }}</p>
            <button :disabled="loading" @click="runQuery(query)">
                {{ loading && currentQuery === query.label ? "ç»Ÿè®¡ä¸­..." : "æ‰§è¡Œç»Ÿè®¡" }}
            </button>
        </div>
    </div>

    <div class="status">
        <div><strong>å½“å‰ç»Ÿè®¡ï¼š</strong> {{ currentQuery || "æœªé€‰æ‹©" }}</div>
        <div><strong>è¿”å›æ•°é‡ï¼š</strong> {{ results.length }}</div>
        <div v-if="error" class="error">é”™è¯¯ï¼š{{ error }}</div>
    </div>

    <div v-if="results.length" class="table-wrapper">
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th v-for="column in columns" :key="column">{{ columnLabels[column] || column }}</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="(row, idx) in results" :key="idx">
                <td>{{ idx + 1 }}</td>
                <td v-for="column in columns" :key="column">
                    <template v-if="column === 'excellent'">
                        <span class="badge badge-excellent">{{ row[column] }}</span>
                    </template>
                    <template v-else-if="column === 'good'">
                        <span class="badge badge-good">{{ row[column] }}</span>
                    </template>
                    <template v-else-if="column === 'pass'">
                        <span class="badge badge-pass">{{ row[column] }}</span>
                    </template>
                    <template v-else-if="column === 'fail'">
                        <span class="badge badge-fail">{{ row[column] }}</span>
                    </template>
                    <template v-else>
                        {{ formatCell(row[column]) }}
                    </template>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                loading: false,
                currentQuery: "",
                results: [],
                error: "",
                columnLabels: {
                    cid: "è¯¾ç¨‹å·",
                    courseName: "è¯¾ç¨‹åç§°",
                    sid: "å­¦å·",
                    studentName: "å­¦ç”Ÿå§“å",
                    avgScore: "å¹³å‡æˆç»©",
                    courseCount: "é€‰è¯¾æ•°ç›®",
                    maxScore: "æœ€é«˜æˆç»©",
                    excellent: "ä¼˜ç§€(â‰¥90)",
                    good: "è‰¯å¥½(80-89)",
                    pass: "åˆæ ¼(60-79)",
                    fail: "ä¸åˆæ ¼(<60)",
                    total: "æ€»é—¨æ•°",
                    studentCount: "é€‰ä¿®äººæ•°"
                },
                queries: [
                    {
                        label: "æœ‰å­¦ç”Ÿé€‰ä¿®çš„è¯¾ç¨‹",
                        desc: "åˆ—å‡ºæœ‰å­¦ç”Ÿé€‰ä¿®çš„æ‰€æœ‰è¯¾ç¨‹åç§°ï¼ˆå»é‡ï¼‰",
                        url: "/api/statistics/distinct-courses"
                    },
                    {
                        label: "å¹³å‡æˆç»©å‰10å­¦ç”Ÿ",
                        desc: "æ‰¾å‡ºå¹³å‡æˆç»©æ’åå‰10çš„å­¦ç”Ÿ",
                        url: "/api/statistics/top10-students-by-avg-score"
                    },
                    {
                        label: "é€‰è¯¾æ•°å‰10å­¦ç”Ÿ",
                        desc: "æ‰¾å‡ºé€‰è¯¾æ•°ç›®æ’åå‰10çš„å­¦ç”Ÿ",
                        url: "/api/statistics/top10-students-by-course-count"
                    },
                    {
                        label: "å­¦ç”Ÿæœ€é«˜æˆç»©",
                        desc: "æ¯ä½åŒå­¦çš„æœ€é«˜æˆç»©ä»¥åŠå¯¹åº”çš„è¯¾ç¨‹å",
                        url: "/api/statistics/student-max-score"
                    },
                    {
                        label: "å­¦ç”Ÿæˆç»©åˆ†å¸ƒ",
                        desc: "æ¯ä½åŒå­¦çš„æˆç»©åˆ†å¸ƒï¼šä¼˜ç§€ã€è‰¯å¥½ã€åˆæ ¼ã€ä¸åˆæ ¼",
                        url: "/api/statistics/student-score-distribution"
                    },
                    {
                        label: "è¯¾ç¨‹é€‰ä¿®äººæ•°ä¸å¹³å‡åˆ†",
                        desc: "æ¯é—¨è¯¾ç¨‹çš„é€‰ä¿®äººæ•°å’Œå¹³å‡æˆç»©",
                        url: "/api/statistics/course-student-count-avg"
                    },
                    {
                        label: "è¯¾ç¨‹æœ€é«˜æˆç»©",
                        desc: "æ¯é—¨è¯¾ç¨‹æœ€é«˜æˆç»©ä»¥åŠå¯¹åº”çš„å­¦ç”Ÿå§“å",
                        url: "/api/statistics/course-max-score"
                    },
                    {
                        label: "å¹³å‡æˆç»©å‰10è¯¾ç¨‹",
                        desc: "å¹³å‡æˆç»©æ’åå‰10çš„è¯¾ç¨‹",
                        url: "/api/statistics/top10-courses-by-avg-score"
                    },
                    {
                        label: "é€‰è¯¾äººæ•°å‰10è¯¾ç¨‹",
                        desc: "é€‰è¯¾äººæ•°æ’åå‰10çš„è¯¾ç¨‹",
                        url: "/api/statistics/top10-courses-by-student-count"
                    }
                ]
            };
        },
        computed: {
            columns() {
                if (!this.results.length) {
                    return [];
                }
                return Object.keys(this.results[0]);
            }
        },
        methods: {
            async runQuery(query) {
                this.loading = true;
                this.error = "";
                this.currentQuery = query.label;
                this.results = [];
                try {
                    const response = await axios.get(query.url);
                    this.results = response.data || [];
                } catch (e) {
                    this.error = e.response?.data?.message || e.message || "æœªçŸ¥é”™è¯¯";
                } finally {
                    this.loading = false;
                }
            },
            formatCell(value) {
                if (value === null || value === undefined) return "-";
                if (typeof value === "object") return JSON.stringify(value);
                return value;
            }
        }
    }).mount("#app");
</script>
</body>
</html>

